name: ðŸš€ Deploy FastAPI on EC2 (self-hosted)

on:
    push:
        branches: [ "main" ]

jobs:
    deploy:
        runs-on: self-hosted

        steps:
            - name: Checkout code
            uses: actions/checkout@v3

            - name: Stop old containers
            run: |
            cd /srv/apps/fastapi_app || exit 1
            docker compose down || true

            - name: Copy new code
            run: |
            rsync -av --delete ./ /srv/apps/fastapi_app/

            - name: Rebuild and restart app
            run: |
            cd /srv/apps/fastapi_app
            docker compose up -d --build

            - name: âœ… Confirm deployment
            run: docker ps
                                                                                                                        
